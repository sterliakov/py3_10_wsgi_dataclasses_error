# Bug explanation #

After upgrading to python3.10 code with dataclasses stopped working with mod_wsgi.

If a class is created with @dataclass decorator (with just a single attribute `x: str`) and then instantiated somewhere in `apps.py` at module level, an exception is thrown. The reason is missing generated `__init__` method (I confirmed that everything works if I define `__init__` manually). Unfortunately, in real project it's part of external library and dataclass is instantiated in imported module, so there's no way to define `__init__` by hands. The code without changes (all packages have same versions too) works with python3.9. 

The traceback is:

```
Traceback (most recent call last):
  File "/var/www/html/proof/proof/wsgi.py", line 16, in <module>
    application = get_wsgi_application()
  File "/usr/local/lib/python3.10/site-packages/django/core/wsgi.py", line 12, in get_wsgi_application
    django.setup(set_prefix=False)
  File "/usr/local/lib/python3.10/site-packages/django/__init__.py", line 24, in setup
    apps.populate(settings.INSTALLED_APPS)
  File "/usr/local/lib/python3.10/site-packages/django/apps/registry.py", line 91, in populate
    app_config = AppConfig.create(entry)
  File "/usr/local/lib/python3.10/site-packages/django/apps/config.py", line 124, in create
    mod = import_module(mod_path)
  File "/usr/local/lib/python3.10/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 883, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/var/www/html/proof/app/apps.py", line 3, in <module>
    from .views import *
  File "/var/www/html/proof/app/views.py", line 4, in <module>
    Test('bar')
TypeError: Test() takes no arguments
``` 

# Repo structure #

This simple django project template shows bug introduced somewhere by python3.10. 

App contains dataclass definition (using dataclasses module from stdlib) in `models.py`. This dataclass is instantiated in `apps.py` on module level, so it's executed on server startup. Docker helps to make sure that nothing from my system configuraton is interfering.

# Steps to reproduce #

1. Run `docker-compose up -d --build` (or build independently and then run)
1. Navigate to `localhost:8000` in any browser or use `curl http://localhost:8000/`. Look at 500 Internal Server Error.
1. Access apache logs (`docker exec -it <container_id> cat /var/log/apache2/error.log`) to see error message.
1. Shut down docker, change `FROM python:3.10-slim` to `FROM python:3.9-slim` in `Dockerfile` and retry. Look at default django page saying that install worked successfully.

# Other notices #

When server is started with `mod_wsgi-express start-server` instead of direct apache call, error is not thrown. It's kinda strange as it uses httpd internally, so I attached directory (`express`) with all files generated by this app. It looks like handler is created in a different way, but I can't catch the point.

Behavior of app does not depend on wsgi mode: both daemon and embedded mode result in error (daemon is used in this docker setup). 

Adding `from .models import Test` to the top of `wsgi.py` doesn't help (tried after reading [this docs page](https://modwsgi.readthedocs.io/en/develop/user-guides/application-issues.html#non-blocking-module-imports)).

# Full log by apache #

_Time labels removed by me to ease reading_

```
[so:warn] [pid 28:tid 139895400185152] AH01574: module wsgi_module is already loaded, skipping
[wsgi:info] [pid 32:tid 139895400185152] mod_wsgi (pid=32): Starting process 'proof' with uid=999, gid=999 and threads=5.
[mpm_event:notice] [pid 29:tid 139895400185152] AH00489: Apache/2.4.51 (Debian) mod_wsgi/4.9.0 Python/3.10 configured -- resuming normal operations
[mpm_event:info] [pid 29:tid 139895400185152] AH00490: Server built: 2021-10-07T17:49:44
[core:notice] [pid 29:tid 139895400185152] AH00094: Command line: '/usr/sbin/apache2'
[wsgi:info] [pid 32:tid 139895400185152] mod_wsgi (pid=32): Python home /usr/local.
[wsgi:info] [pid 32:tid 139895400185152] mod_wsgi (pid=32): Initializing Python.
[wsgi:info] [pid 32:tid 139895400185152] mod_wsgi (pid=32): Attach interpreter ''.
[wsgi:info] [pid 32:tid 139895400185152] mod_wsgi (pid=32): Imported 'mod_wsgi'.
[so:warn] [pid 10:tid 139844212804928] AH01574: module wsgi_module is already loaded, skipping
[core:warn] [pid 10:tid 139844212804928] AH00098: pid file /var/run/apache2/apache2.pid overwritten -- Unclean shutdown of previous Apache run?
[wsgi:info] [pid 11:tid 139844212804928] mod_wsgi (pid=11): Starting process 'proof' with threads=5.
[wsgi:info] [pid 11:tid 139844212804928] mod_wsgi (pid=11): Python home /usr/local.
[wsgi:info] [pid 11:tid 139844212804928] mod_wsgi (pid=11): Initializing Python.
[mpm_event:notice] [pid 10:tid 139844212804928] AH00489: Apache/2.4.51 (Debian) mod_wsgi/4.9.0 Python/3.10 configured -- resuming normal operations
[mpm_event:info] [pid 10:tid 139844212804928] AH00490: Server built: 2021-10-07T17:49:44
[core:notice] [pid 10:tid 139844212804928] AH00094: Command line: '/usr/sbin/apache2 -D FOREGROUND'
[wsgi:info] [pid 11:tid 139844212804928] mod_wsgi (pid=11): Attach interpreter ''.
[wsgi:info] [pid 11:tid 139844212804928] mod_wsgi (pid=11): Imported 'mod_wsgi'.
[wsgi:info] [pid 11:tid 139844176623360] mod_wsgi (pid=11): Create interpreter 'localhost:8000|'.
[wsgi:info] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314] mod_wsgi (pid=11, process='proof', application='localhost:8000|'): Loading Python script file '/var/www/html/proof/proof/wsgi.py'.
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314] mod_wsgi (pid=11): Failed to exec Python script file '/var/www/html/proof/proof/wsgi.py'.
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314] mod_wsgi (pid=11): Exception occurred processing WSGI script '/var/www/html/proof/proof/wsgi.py'.
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314] Traceback (most recent call last):
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "/var/www/html/proof/proof/wsgi.py", line 16, in <module>
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]     application = get_wsgi_application()
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "/usr/local/lib/python3.10/site-packages/django/core/wsgi.py", line 12, in get_wsgi_application
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]     django.setup(set_prefix=False)
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "/usr/local/lib/python3.10/site-packages/django/__init__.py", line 24, in setup
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]     apps.populate(settings.INSTALLED_APPS)
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "/usr/local/lib/python3.10/site-packages/django/apps/registry.py", line 91, in populate
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]     app_config = AppConfig.create(entry)
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "/usr/local/lib/python3.10/site-packages/django/apps/config.py", line 124, in create
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]     mod = import_module(mod_path)
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "/usr/local/lib/python3.10/importlib/__init__.py", line 126, in import_module
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]     return _bootstrap._gcd_import(name[level:], package, level)
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "<frozen importlib._bootstrap_external>", line 883, in exec_module
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "/var/www/html/proof/app/apps.py", line 3, in <module>
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]     from .views import *
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]   File "/var/www/html/proof/app/views.py", line 4, in <module>
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314]     Test('bar')
[wsgi:error] [pid 11:tid 139844176623360] [remote 192.168.112.1:52314] TypeError: Test() takes no arguments
```